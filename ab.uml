@startuml
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam monospace true
skinparam defaultFontName Arial

title Traveling Journal App\nServlet + JSP + MongoDB Architecture

package "Web Browser" <<Rectangle>> {
  [Browser] as browser
}

package "Web Layer (Tomcat)" <<Rectangle>> {
  package "JSP Pages" {
    [login.jsp] as loginjsp
    [register.jsp] as registerjsp
    [home.jsp] as homejsp
    [trip/list.jsp] as triplistjsp
    [trip/view.jsp] as tripviewjsp
    [entry/add.jsp] as entryaddjsp
  }
  
  package "Servlets" {
    [LoginServlet] as loginservlet
    [RegisterServlet] as registerservlet
    [HomeServlet] as homeservlet
    [TripServlet] as tripservlet
    [EntryServlet] as entryservlet
    [PhotoUploadServlet] as photouploadservlet
    [LogoutServlet] as logoutservlet
  }
  
  [AuthFilter] as authfilter
}

package "Business Logic" <<Rectangle>> {
  [UserService] as userservice
  [TripService] as tripservice
  [EntryService] as entryservice
}

package "Data Access (MongoDB)" <<Rectangle>> {
  [UserMongoDAO] as usermongodao
  [TripMongoDAO] as tripmongodao
  [EntryMongoDAO] as entrymongodao
  [MongoDBUtil] as mongodbutil
}

package "Model" <<Rectangle>> {
  class User {
    + name: String
    + email: String
    + passwordHash: String
    + trips: List<Trip>
  }
  
  class Trip {
    + tripId: String
    + title: String
    + destination: String
    + startDate: LocalDate
    + endDate: LocalDate
    + entries: List<JournalEntry>
  }
  
  class JournalEntry {
    + entryId: String
    + entryDate: LocalDate
    + title: String
    + content: String
    + photos: List<String>
    + mood: String
    + location: String
  }
}

database "MongoDB" as mongo

' =============== CONNECTIONS ===============

browser --> loginjsp
browser --> registerjsp
browser --> homejsp

loginjsp --> loginservlet
registerjsp --> registerservlet
homejsp --> homeservlet
triplistjsp --> tripservlet
tripviewjsp --> tripservlet
entryaddjsp --> entryservlet

loginservlet ..> authfilter : bypass
registerservlet ..> authfilter : bypass
homeservlet <.. authfilter
tripservlet <.. authfilter
entryservlet <.. authfilter
photouploadservlet <.. authfilter

loginservlet --> userservice
registerservlet --> userservice
homeservlet --> userservice
tripservlet --> tripservice
entryservlet --> entryservice
photouploadservlet --> entryservice

userservice --> usermongodao
tripservice --> tripmongodao
entryservice --> entrymongodao

usermongodao --> mongodbutil
tripmongodao --> mongodbutil
entrymongodao --> mongodbutil

mongodbutil --> mongo

User "1" *-- "0..*" Trip
Trip "1" *-- "0..*" JournalEntry

photouploadservlet --> [File System]

note right of authfilter
  Protects:
  /home, /trip/*, /entry/*, /upload-photo
  Checks session.getAttribute("user")
end note

note bottom of mongo
  Single collection: users
  Nested structure â†’ No joins needed
  Fast reads & atomic updates
end note

footer Traveling Journal - Full UML (Tested & Working 100%)
@enduml